{
    "version": 3,
    "sources": ["../../../../../../es6/eshop/modules/documents/actions/documents.js"],
    "names": ["fetchDocuments", "legalForm", "dispatch", "getState", "status", "documentsAreLoading", "documentsUnfilteredAreLoading", "RemoteApi", "getDocumentsForCart", "then", "response", "type", "ACTIONS", "FETCH_DOCUMENTS_FOR_CART", "payload", "catch", "FETCH_DOCUMENTS_ERROR", "getDocumentsForCartUnfiltered", "FETCH_DOCUMENTS_UNFILTERED_FOR_CART", "FETCH_DOCUMENTS_UNFILTERED_ERROR", "bool", "FETCH_DOCUMENTS_LOADING", "isLoading", "FETCH_DOCUMENTS_UNFILTERED_LOADING", "documentDownloadStarted", "code", "DOWNLOAD_DOCUMENT_START", "documentReadyToDownload", "link", "DOCUMENT_READY_TO_DOWNLOAD", "getOrCreateDocument", "bundleNo", "documentType", "documentCode", "documentData", "documentCodes", "saveDataBeforeDocumentCreation", "checkDocumentExistence", "result", "createDocument", "documentDefinitionCodes", "factory", "findDocumentInLocalStorage", "getDocuments", "DOWNLOAD_DOCUMENT_ERROR", "getOrCreateDocumentPickup", "RemoteApiPickup", "clearAllLinks", "DOCUMENT_LINK_CLEAR", "checkoutData", "RemoteApiCheckout", "doSaveCheckoutData", "DATA_SAVED_BEFORE_DOCUMENT_CREATION"],
    "mappings": "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",
    "sourcesContent": ["import * as ACTIONS from \"../actionTypes\";\nimport RemoteApi from \"../remoteApi\";\nimport RemoteApiPickup from \"../pickup/remoteApi\";\nimport RemoteApiCheckout from \"eshop/modules/checkout/remoteApi\";\nimport {openDocument} from \"eshop/modules/checkout/actions/data\";\nimport {getDocumentsFetchInProgress, getAnyDocumentIsBeingLoaded, isDocumentsDataSavedBeforeCreation} from \"../selectors\";\nimport {getCheckoutData, getLegalForm, getDeliveryAndPaymentStep} from \"../../checkout/selectors\";\n\nexport const fetchDocuments = (legalForm = \"\") => (dispatch, getState) => {\n    let status = getDocumentsFetchInProgress(getState());\n\n    if (!status) {\n        dispatch(documentsAreLoading(true));\n        dispatch(documentsUnfilteredAreLoading(true));\n\n        RemoteApi.getDocumentsForCart(legalForm || getLegalForm(getState()))\n            .then(response => {\n                dispatch({\n                    type: ACTIONS.FETCH_DOCUMENTS_FOR_CART,\n                    payload: response\n                });\n                dispatch(documentsAreLoading(false));\n            })\n            .catch(response => {\n                dispatch({\n                    type: ACTIONS.FETCH_DOCUMENTS_ERROR,\n                    payload: response\n                })\n            });\n\n        RemoteApi.getDocumentsForCartUnfiltered(legalForm || getLegalForm(getState()))\n            .then(response => {\n                dispatch({\n                    type: ACTIONS.FETCH_DOCUMENTS_UNFILTERED_FOR_CART,\n                    payload: response\n                });\n                dispatch(documentsUnfilteredAreLoading(false));\n            })\n            .catch(response => {\n                dispatch({\n                    type: ACTIONS.FETCH_DOCUMENTS_UNFILTERED_ERROR,\n                    payload: response\n                })\n            });\n    }\n};\n\nexport const documentsAreLoading = (bool) => ({\n    type: ACTIONS.FETCH_DOCUMENTS_LOADING,\n    isLoading: bool\n});\n\nexport const documentsUnfilteredAreLoading = (bool) => ({\n    type: ACTIONS.FETCH_DOCUMENTS_UNFILTERED_LOADING,\n    isLoading: bool\n});\n\nexport const documentDownloadStarted = (code) => ({\n    type: ACTIONS.DOWNLOAD_DOCUMENT_START,\n    code: code\n});\n\nexport const documentReadyToDownload = (code, link) => ({\n    type: ACTIONS.DOCUMENT_READY_TO_DOWNLOAD,\n    code, link\n});\n\n/**\n * Gets of creates document to download\n * @param {String} code Document code\n * @param bundleNo Bundle number\n * @param documentType document type\n */\nexport const getOrCreateDocument = (code, bundleNo, documentType) => (dispatch, getState) => {\n    let status = getAnyDocumentIsBeingLoaded(getState());\n    let documentCode = code + (bundleNo ? '_' + bundleNo : '');\n\n    if (!status) {\n        dispatch(documentDownloadStarted(documentCode));\n\n        let documentData = {\n            documentCodes: code,\n            bundleNo: bundleNo\n        };\n\n        saveDataBeforeDocumentCreation(getState, dispatch);\n\n        RemoteApi.checkDocumentExistence({\n            documentCode: code,\n            bundleNo: bundleNo\n        }).then(result => {\n            return result === false ?\n                RemoteApi.createDocument({\n                    documentDefinitionCodes: code,\n                    bundleNo: bundleNo,\n                    factory: \"MOBILE\"\n                }) : result\n\n        }).then(() => {\n            return RemoteApi.findDocumentInLocalStorage(documentData)\n        }).then(result => {\n            return !result[code] ? RemoteApi.getDocuments(documentData).then(() => {\n                return RemoteApi.findDocumentInLocalStorage(documentData)\n            }) : result\n        }).then(result => {\n            dispatch(documentReadyToDownload(documentCode, result[code]));\n            openDocument(result[code]);\n        }).catch(result => {\n            dispatch({\n                type: ACTIONS.DOWNLOAD_DOCUMENT_ERROR,\n                payload: result\n            });\n        });\n\n    }\n};\n\n/**\n * Gets of creates document to download\n * @param {String} code Document code\n * @param bundleNo Bundle number\n * @param documentType document type\n */\nexport const getOrCreateDocumentPickup = (code, bundleNo, documentType) => (dispatch, getState) => {\n    let status = getAnyDocumentIsBeingLoaded(getState());\n    let documentCode = code + (bundleNo ? '_' + bundleNo : '');\n\n    if (!status) {\n        dispatch(documentDownloadStarted(documentCode));\n\n        let documentData = {\n            documentCodes: code,\n            bundleNo: bundleNo\n        };\n\n        saveDataBeforeDocumentCreation(getState, dispatch);\n\n        RemoteApiPickup.checkDocumentExistence({\n            documentCode: code,\n            bundleNo: bundleNo\n        }).then(result => {\n            return result === false ?\n                RemoteApiPickup.createDocument({\n                    documentDefinitionCodes: code,\n                    bundleNo: bundleNo,\n                    factory: \"MOBILE\"\n                }) : result\n\n        }).then(() => {\n            return RemoteApiPickup.findDocumentInLocalStorage(documentData)\n        }).then(result => {\n            return !result[code] ? RemoteApiPickup.getDocuments(documentData).then(() => {\n                return RemoteApiPickup.findDocumentInLocalStorage(documentData)\n            }) : result\n        }).then(result => {\n            dispatch(documentReadyToDownload(documentCode, result[code]));\n            openDocument(result[code]);\n        }).catch(result => {\n            dispatch({\n                type: ACTIONS.DOWNLOAD_DOCUMENT_ERROR,\n                payload: result\n            });\n        });\n\n    }\n};\n\nexport const clearAllLinks = () => ({\n    type: ACTIONS.DOCUMENT_LINK_CLEAR\n});\n\nfunction saveDataBeforeDocumentCreation(getState, dispatch) {\n    if (getDeliveryAndPaymentStep(getState())) {\n        if (isDocumentsDataSavedBeforeCreation(getState()) === false) {\n            const checkoutData = getCheckoutData(getState());\n            RemoteApiCheckout.doSaveCheckoutData(checkoutData).then(() => {\n                dispatch({\n                    type: ACTIONS.DATA_SAVED_BEFORE_DOCUMENT_CREATION,\n                    payload: true\n                });\n            });\n        }\n    }\n};"],
    "file": "documents.js"
}