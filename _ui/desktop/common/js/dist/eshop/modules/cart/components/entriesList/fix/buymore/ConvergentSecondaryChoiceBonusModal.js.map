{
    "version": 3,
    "sources": ["../../../../../../../../../es6/eshop/modules/cart/components/entriesList/fix/buymore/ConvergentSecondaryChoiceBonusModal.jsx"],
    "names": ["ConvergentSecondaryChoiceBonusModal", "props", "entries", "mandatories", "services", "hidden", "state", "open", "popup", "callback", "event", "modalContent", "vasesWithStatuses", "prepareVasesWithStatuses", "nextProps", "productList", "_", "isEqual", "setState", "forEach", "proposition", "propositionId", "map", "vas", "selected", "mandatory", "presentation", "Object", "keys", "length", "markVasesAsSelected", "markVasesAsMandatory", "markVasesAsHidden", "flatMap", "v", "key", "vases", "id", "undefined", "propositionMandatories", "filter", "productCode", "find", "includes", "onClose", "onSave", "onClick", "_cancelInterceptedClick", "bonusWithStatus", "bonus", "e", "b", "presentableProducts", "p", "deviceType", "descriptions", "migratedProducts", "presentableBonus", "bonusModalTitle", "bonusRelatedProductSectionTitle", "_onClickInterceptor", "bind", "showNetPrices", "configurables", "bonusSectionTitle", "_onSaveWrapper", "Component", "propTypes", "uid", "PropTypes", "string", "header", "bundle", "cartBundle", "bool", "object", "array"],
    "mappings": "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",
    "sourcesContent": ["import React, {Component} from \"react\";\nimport {PropTypes} from \"prop-types\";\nimport OraModal from \"eshop/modules/core/components/ui/Modal\";\nimport {ProductGroup, SaveVasesButton} from \"./modalFragments/ModalFragments\"\nimport {prepareDevices} from \"../../../../analyzer/DeviceUtils\";\n\nexport default class ConvergentSecondaryChoiceBonusModal extends Component  {\n    constructor (props) {\n        super(props);\n        const {entries, mandatories, services, hidden} = props;\n        this.state = {\n            open: this.props.open,\n            popup: false,\n            callback: null,\n            event: null,\n            modalContent: null,\n            vasesWithStatuses: this.prepareVasesWithStatuses(entries, mandatories, services, hidden)\n        }\n    }\n\n    componentWillReceiveProps(nextProps){\n        const {entries, mandatories, services, productList, hidden} = nextProps;\n        if (!_.isEqual(entries, this.props.entries) || !_.isEqual(productList, this.props.productList)) {\n            const vasesWithStatuses = this.prepareVasesWithStatuses(entries, mandatories, services, hidden);\n            this.setState({\n                vasesWithStatuses\n            })\n        }\n        this.setState({\n            open: nextProps.open\n        })\n    }\n\n    prepareVasesWithStatuses(entries, mandatories, services, hidden) {\n        let vasesWithStatuses = {};\n        _.forEach(services, (proposition, propositionId) => {\n            vasesWithStatuses[propositionId] = proposition.map(vas => ({\n                ...vas,\n                propositionId,\n                selected: false,\n                mandatory: false,\n                presentation: \"visible\"\n            }));\n        });\n        if (Object.keys(vasesWithStatuses).length === 0) {\n            return null;\n        }\n\n        this.markVasesAsSelected(vasesWithStatuses, entries);\n        this.markVasesAsMandatory(vasesWithStatuses, entries, mandatories);\n        this.markVasesAsHidden(vasesWithStatuses, hidden);\n\n        return _.flatMap(vasesWithStatuses, v => v);\n    }\n\n    markVasesAsSelected(vasesWithStatuses, entries) {\n        _.forEach(Object.keys(entries), key => {\n            _.forEach(vasesWithStatuses, vases => {\n                _.forEach(vases, vas => {\n                    if (entries[key][vas.id] !== undefined) {\n                        vas.selected = entries[key][vas.id];\n                    }\n                });\n            })\n        });\n    }\n\n    markVasesAsMandatory(vasesWithStatuses, entries, mandatories) {\n\n        _.forEach(mandatories, (propositionMandatories, propositionId) => {\n            propositionMandatories\n                .filter(productCode => entries[propositionId] && entries[propositionId][productCode])\n                .map(productCode => vasesWithStatuses[propositionId].find(vas => vas.id === productCode))\n                .filter(vas => vas)\n                .forEach(vas => vas.mandatory = true);\n        });\n    }\n\n    markVasesAsHidden(vasesWithStatuses, hidden) {\n        _.forEach(vasesWithStatuses, vases => {\n            _.forEach(vases, vas => {\n                vas.presentation = _.includes(hidden, vas.id) ? \"hidden\" : \"visible\";\n            });\n        });\n    }\n\n    _onSaveWrapper(){\n        this.props.onClose();\n        this.props.onSave();\n    }\n\n    _onClickInterceptor(productCode, propositionId, modalContent) {\n        return (event) => {\n            this.setState({\n                popup: true,\n                callback: this.props.onClick(productCode, propositionId),\n                event: event,\n                modalContent: modalContent\n            });\n        }\n    }\n\n    _runInterceptedClick() {\n        this.state.callback(this.state.event);\n        this._cancelInterceptedClick();\n    }\n\n    _cancelInterceptedClick() {\n        this.setState({\n            popup: false,\n            callback: null,\n            event: null,\n            modalContent: null\n        });\n    }\n\n    render(){\n\n        let bonusWithStatus = [this.props.bonus].map(bonus => {\n            bonus.selected = false;\n            bonus.mandatory = false;\n            bonus.presentation = \"visible\";\n            return bonus;\n        });\n\n        _.flatMap(this.props.entries, e => Object.keys(e)\n            .filter(productCode => e[productCode])\n            .map(productCode => bonusWithStatus.find(bonus => bonus.id === productCode))\n            .filter(b => b)\n            .forEach(b => b.selected = true))\n\n        const presentableProducts = [\n            ...this.state.vasesWithStatuses.filter(p => !p.deviceType && !p.mandatory),\n            ...prepareDevices(this.state.vasesWithStatuses.filter(p => !!p.deviceType), this.props.descriptions, this.props.migratedProducts)];\n\n        const presentableBonus = bonusWithStatus;\n        return(\n            <OraModal open={this.props.open} onClose={this.props.onClose} size=\"medium\">\n                <div className=\"l-row u-spacing-top-s u-spacing-left-l u-spacing-l u-small-spacing\">\n                    <p className=\"h3\">{this.props.descriptions.bonusModalTitle}</p>\n                    <p className=\"h4 u-spacing-top-xl u-small-spacing\">{this.props.descriptions.bonusRelatedProductSectionTitle}</p>\n                </div>\n                <div>\n                    <ProductGroup\n                        key={'bonusRelatedProducts'}\n                        inputType={\"CHECKBOX\"}\n                        products={presentableProducts}\n                        onClick={this.props.onClick}\n                        onClickWrapped={this._onClickInterceptor.bind(this)}\n                        net={this.props.showNetPrices}\n                        configurables={this.props.configurables}\n                    />\n                </div>\n                <div className=\"l-row u-spacing-top-xl u-spacing-left-l u-spacing-l u-small-spacing\">\n                    <p className=\"h4\">{this.props.descriptions.bonusSectionTitle}</p>\n                </div>\n                <div>\n                    <ProductGroup\n                        key={'bonus'}\n                        inputType={\"CHECKBOX\"}\n                        products={presentableBonus}\n                        onClick={this.props.onClick}\n                        onClickWrapped={this._onClickInterceptor.bind(this)}\n                        net={this.props.showNetPrices}\n                        configurables={this.props.configurables}\n                    />\n                </div>\n                <div className=\"l-row\">\n                    <div className=\"l-col l-col-small-12 l-col-medium-8 l-col-8\"/>\n                </div>\n                <SaveVasesButton saveVasesClicked={this._onSaveWrapper.bind(this)}/>\n            </OraModal>)\n    }\n}\n\nConvergentSecondaryChoiceBonusModal.propTypes = {\n    uid: PropTypes.string,\n    header: PropTypes.string,\n    bundle: PropTypes.string,\n    cartBundle: PropTypes.string,\n    propositionId: PropTypes.string,\n    open: PropTypes.bool,\n    descriptions: PropTypes.object,\n    services: PropTypes.array,\n    entries: PropTypes.object,\n    mandatories: PropTypes.array,\n    hidden: PropTypes.array\n};"],
    "file": "ConvergentSecondaryChoiceBonusModal.js"
}