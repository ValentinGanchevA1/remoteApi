{
    "version": 3,
    "sources": ["../../../../../../es6/eshop/modules/cart/actions/resources.js"],
    "names": ["resourceModalOpen", "bundleNo", "dispatch", "getState", "type", "ACTIONS", "RESOURCE_MODAL_OPEN", "entry", "find", "lowerInstallmentsModalOpen", "LOWER_INSTALLMENTS_MODAL_OPEN", "lowerInstallmentsModaClose", "LOWER_INSTALLMENTS_MODAL_CLOSE", "resourceModalClose", "RESOURCE_MODAL_CLOSE", "changeMsisdnFailed", "response", "CHANGE_MSISDN_FAILED", "payload", "fetchMsisdns", "changeMsisdnSuccess", "CHANGE_MSISDN_SUCCESS", "changeMsisdn200Handler", "responseData", "message", "updateResources", "msisdn", "simCard", "changedMsisdn", "changedSimCard", "id", "propositionId", "bundleCode", "updateCartSimCardsAndMsisdn", "productCode", "updateCartMsisdn", "updateCartSimCards", "bundle", "offer", "productsToRemove", "productsToAdd", "CHANGE_SIMCARD", "RemoteApi", "postUpdateCartSimCards", "then", "CHANGE_SIMCARD_SUCCESS", "CHANGE_MSISDN", "changeMsisdn", "msisdns", "length", "getMsisdns", "FETCH_MSISDNS", "fetchSimCards", "getSimCards", "FETCH_SIM_CARDS", "SET_MSISDN", "changeSimCard", "SET_SIMCARD"],
    "mappings": "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",
    "sourcesContent": ["import * as ACTIONS from \"../actionTypes\";\nimport RemoteApi from \"../remoteApi\";\nimport {allCartEntries, getMsisdns, getResourceModalBundleNo, getSimCards, getMsisdn, getSimCard, getEntryForResourceModal} from \"../selectors\";\nimport {getCartIsNet, getPriceIsNet} from \"eshop/modules/cart/selectors\";\nimport {reloadCartState} from \"./cart\";\n\nexport const resourceModalOpen = (bundleNo) => (dispatch, getState) => {\n    dispatch({type: ACTIONS.RESOURCE_MODAL_OPEN,\n                bundleNo: bundleNo,\n                entry: allCartEntries(getState()).find(entry => entry.bundleNo === bundleNo)});\n};\n\nexport const lowerInstallmentsModalOpen = (bundleNo) => (dispatch) => {\n    dispatch({type: ACTIONS.LOWER_INSTALLMENTS_MODAL_OPEN,\n         bundleNo: bundleNo\n    });\n};\n\nexport const lowerInstallmentsModaClose = (bundleNo) => (dispatch, getState) => {\n    dispatch({type: ACTIONS.LOWER_INSTALLMENTS_MODAL_CLOSE,\n        bundleNo: bundleNo\n    });\n};\n\nexport const resourceModalClose = (bundleNo) => (dispatch) => {\n    dispatch({type: ACTIONS.RESOURCE_MODAL_CLOSE,\n                    bundleNo: bundleNo});\n};\n\nconst changeMsisdnFailed = (bundleNo, response) => (dispatch) => {\n    dispatch({\n        type: ACTIONS.CHANGE_MSISDN_FAILED,\n        payload: response\n    });\n    fetchMsisdns()(dispatch);\n};\n\nconst changeMsisdnSuccess = (bundleNo, response) => (dispatch, getState) => {\n    dispatch({\n        type: ACTIONS.CHANGE_MSISDN_SUCCESS,\n        bundleNo: bundleNo,\n        payload: response\n    });\n    reloadCartState()(dispatch, getState);\n};\n\n/*\n * Checks if HTTP200 wraps error message\n */\nconst changeMsisdn200Handler = (dispatch, getState, bundleNo, responseData) => {\n    if(responseData && responseData.message && typeof responseData.message === \"string\"){\n        dispatch(changeMsisdnFailed(bundleNo, responseData));\n    } else {\n        dispatch(changeMsisdnSuccess(bundleNo, responseData));\n    }\n};\n\nexport const updateResources = () => (dispatch, getState) => {\n    const msisdn = getMsisdn(getState());\n    const simCard = getSimCard(getState());\n    const entry = getEntryForResourceModal(getState());\n    const bundleNo = getResourceModalBundleNo(getState());\n    const changedMsisdn = msisdn && msisdn !== entry.msisdn;\n    const changedSimCard = !entry.simCard && !!simCard.id || !!entry.simCard && simCard.id !== entry.simCard.id;\n    const propositionId = entry.propositionId != null ? entry.propositionId : entry.bundleCode;\n    if(changedMsisdn && changedSimCard) {\n        updateCartSimCardsAndMsisdn(propositionId,\n                                    entry.productCode,\n                                    bundleNo,\n                                    entry.simCard ? [entry.simCard.id] : [],\n                                    simCard.id === \"\" ? [] : [simCard.id],\n                                    msisdn)(dispatch, getState);\n    } else if(changedMsisdn) {\n        updateCartMsisdn(msisdn, bundleNo)(dispatch, getState);\n    } else if(changedSimCard) {\n        updateCartSimCards(propositionId,\n                                    entry.productCode,\n                                    bundleNo,\n                                    entry.simCard ? [entry.simCard.id] : [],\n                                    simCard.id === \"\" ? [] : [simCard.id])(dispatch, getState);\n    } else {\n        resourceModalClose(bundleNo)(dispatch);\n    }\n};\n\nfunction updateCartSimCards(bundle, offer, bundleNo, productsToRemove, productsToAdd) {\n    return (dispatch, getState) => {\n        dispatch({type: ACTIONS.CHANGE_SIMCARD});\n        RemoteApi.postUpdateCartSimCards(bundle, offer, bundleNo, productsToRemove, productsToAdd)\n            .then(() => {\n                dispatch({\n                    type: ACTIONS.CHANGE_SIMCARD_SUCCESS\n                });\n                reloadCartState()(dispatch, getState);\n            });\n    };\n}\n\nfunction updateCartMsisdn(msisdn, bundleNo) {\n    return (dispatch, getState) => {\n        dispatch({type: ACTIONS.CHANGE_MSISDN});\n        RemoteApi.changeMsisdn(msisdn, bundleNo).then(\n            responseData => changeMsisdn200Handler(dispatch, getState, bundleNo, responseData)\n        );\n    };\n}\n\nfunction updateCartSimCardsAndMsisdn(bundle, offer, bundleNo, productsToRemove, productsToAdd, msisdn) {\n    return (dispatch, getState) => {\n        RemoteApi.changeMsisdn(msisdn, bundleNo)\n            .then(responseData => {\n                if (responseData && responseData.message && typeof responseData.message === \"string\") {\n                    dispatch({\n                        type: ACTIONS.CHANGE_MSISDN_FAILED,\n                        payload: responseData\n                    });\n                } else {\n                    RemoteApi.postUpdateCartSimCards(bundle, offer, bundleNo, productsToRemove, productsToAdd)\n                        .then(() => {\n                            dispatch({\n                                type: ACTIONS.CHANGE_SIMCARD_SUCCESS\n                            });\n                            reloadCartState()(dispatch, getState);\n                        });\n                    dispatch({\n                        type: ACTIONS.CHANGE_MSISDN_SUCCESS,\n                        bundleNo: bundleNo,\n                        payload: responseData\n                    });\n                }\n            });\n    };\n}\n\nexport function fetchMsisdns() {\n    return (dispatch, getState) => {\n        const msisdns = getMsisdns(getState());\n        if(!msisdns.length) {\n            RemoteApi.getMsisdns(getResourceModalBundleNo(getState()))\n                .then((response) => dispatch({\n                    type: ACTIONS.FETCH_MSISDNS,\n                    payload: response\n                }));\n        }\n    };\n}\n\nexport function fetchSimCards() {\n    return (dispatch, getState) => {\n        const bundleNo = getResourceModalBundleNo(getState());\n        RemoteApi.getSimCards(bundleNo).then((response) => {\n            dispatch({\n                type: ACTIONS.FETCH_SIM_CARDS,\n                bundleNo: bundleNo,\n                payload: response\n            });\n        });\n    };\n}\n\nexport const changeMsisdn = (msisdn) => (dispatch) => {\n    dispatch({type: ACTIONS.SET_MSISDN, msisdn});\n};\n\nexport const changeSimCard = (simCard) => (dispatch) => {\n    dispatch({type: ACTIONS.SET_SIMCARD, simCard});\n};"],
    "file": "resources.js"
}