{
    "version": 3,
    "sources": ["../../../../../es6/eshop/flux/utils/OraModalService.js"],
    "names": ["window", "oraModalService", "modals", "showing", "reactLegacyVersion", "ReactDOM", "version", "startsWith", "modalClose", "onClose", "setTimeout", "createModalRoot", "id", "modalRoot", "document", "getElementById", "createElement", "className", "body", "appendChild", "add", "component", "console", "log", "element", "props", "root", "fallback", "OPL", "UI", "on", "EVENTS", "modules", "modal", "closed", "render", "initModules", "open", "data", "viewModal", "fire", "close", "Promise", "resolve", "reject", "x", "off"],
    "mappings": "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",
    "sourcesContent": ["import ReactDOM from \"react-dom\";\n\n//TODO scheduling popups\nwindow.oraModalService = window.oraModalService || {\n    modals: {},\n    showing: null\n}\n// earlier versions of React go crazy when components are moved around in DOM\nvar reactLegacyVersion = ReactDOM.version.startsWith('0.');\n\nfunction modalClose() {\n    let showing = window.oraModalService.showing\n    if (showing.onClose)\n        setTimeout(showing.onClose, 0);\n    window.oraModalService.showing = null;\n}\n\nfunction createModalRoot(id) {\n    var modalRoot = document.getElementById(\"modal-\" + id);\n    if (!modalRoot) {\n        modalRoot = document.createElement('div');\n        modalRoot.id = \"modal-\" + id;\n        modalRoot.className = \"u-hide\";\n        document.body.appendChild(modalRoot);\n    }\n\n    return modalRoot;\n}\n\n/**\n * Register a new modal component.\n * @param component A component definition for the modal. Should be a stateless function that returns an OraModalComponent as its root\n * element. Avoid accessing another component's state in inline component definitions (i.e. when using arrow syntax) - it might work, but\n * the modal component will not be updated and it can possibly lead to invariant violations. Another component's methods can be used as\n * callbacks, but for modals that can be opened from outside that component, binding a flux action is preferred.\n */\nfunction add(component) {\n    let modals = window.oraModalService.modals\n\n    if (typeof component !== \"function\")\n        console.log(\"Modal component should be a stateless function.\");\n    let element = component({});\n    let id = element.props.id;\n    let modalRoot = createModalRoot(id);\n    /*\n     * FIXME!\n     * onClose and fallback aren't registered for components that are not stateless functions with OraModal as root, because those are the\n     * props of OraModal itself and not the wrapping component. It might be necessary to find another way of passing those 'meta props'.\n     */\n    modals[id] = {\n        id: id,\n        component: component,\n        root: modalRoot,\n        onClose: element.props.onClose,\n        fallback: typeof element.props.fallback === \"function\"\n    };\n    OPL.UI.on(OPL.UI.EVENTS.modules.modal.closed, modalClose, id + '-trigger');\n    ReactDOM.render(element, modalRoot, function () {\n        OPL.UI.initModules(modalRoot);\n    });\n}\n\n/**\n * Opens a modal with a given id.\n * @param id Identifier of the modal (used in ModalService.add)\n * @param data Data that will be passed to the component as props. Keep in mind that the modal's content is static and will only display\n * the data that was passed to it when opening.\n */\nfunction open(id, data={}) {\n    let modals = window.oraModalService.modals\n    let showing = window.oraModalService.showing\n    if (showing !== null) {\n        console.log(\"Trying to open a modal when another one is showing!\");\n        return;\n    }\n    var modal = modals[id];\n    if (modal) {\n        if (reactLegacyVersion && modal.fallback) {\n            modal.component(data).props.fallback();\n        } else {\n            viewModal(modal, data);\n        }\n    } else {\n        console.log(\"Modal with id \" + id + \" has not been registered.\");\n    }\n}\n\nfunction viewModal(modal, data) {\n    window.oraModalService.showing = modal;\n    ReactDOM.render(modal.component(data), modal.root, function () {\n        OPL.UI.fire(OPL.UI.EVENTS.modules.modal.open, '', modal.id + \"-trigger\");\n    });\n}\n\nfunction close() {\n    let showing = window.oraModalService.showing\n    if (showing === null) return Promise.resolve();\n\n    return new Promise(function(resolve, reject) {\n        OPL.UI.on(OPL.UI.EVENTS.modules.modal.closed, function x(id){\n            OPL.UI.off(OPL.UI.EVENTS.modules.modal.closed, x, id);\n            resolve();\n        }, showing.id + \"-trigger\");\n        OPL.UI.fire(OPL.UI.EVENTS.modules.modal.close, '', showing.id + \"-trigger\");\n    });\n}\n\nexport default {\n    add: add,\n    open: open,\n    close: close\n};\n"],
    "file": "OraModalService.js"
}